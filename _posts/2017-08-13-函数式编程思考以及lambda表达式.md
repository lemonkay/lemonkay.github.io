---
ã€€ã€€layout: default
ã€€ã€€title: å‡½æ•°å¼ç¼–ç¨‹æ€è€ƒä»¥åŠlambdaè¡¨è¾¾å¼.md
---
### å‡½æ•°å¼ç¼–ç¨‹æ€è€ƒä»¥åŠlambdaè¡¨è¾¾å¼
#### é¦–å…ˆéœ€è¦ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š
> * [é˜®ä¸€å³°å…³äºå‡½æ•°å¼ç¼–ç¨‹çš„ç†è§£](http://www.ruanyifeng.com/blog/2017/02/fp-tutorial.html)
> * [åœ¨githubæ‰¾åˆ°çš„å…³äºjava8 lambdaçš„ç†è§£](https://github.com/CarpenterLee/JavaLambdaInternals)

1. å…³äºè¿™äº›å­¦ä¹ çš„ä»£ç 

``` java
package com.reflex.service;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.function.Predicate;

public class Java8Test {
    public static void main(String args[]) {
        List<Integer> list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9);

        // Predicate<Integer> predicate2 = n -> n > 3
        // n æ˜¯ä¸€ä¸ªå‚æ•°ä¼ é€’åˆ° Predicate æ¥å£çš„ test æ–¹æ³•
        // å¦‚æœ n å¤§äº 3 test æ–¹æ³•è¿”å› true

        System.out.println("è¾“å‡ºå¤§äº 3 çš„æ‰€æœ‰æ•°å­—:");
        eval(list, n -> n > 3);

//      Runnable
        new Thread(
                () -> {
                    System.out.print("Hello");
                    System.out.println("World");
                }
        ).start();

        List<String> strList = Arrays.asList("I", "love", "you", "too");
//       Comparator
        Collections.sort(strList, (s1, s2) -> {// çœç•¥å‚æ•°è¡¨çš„ç±»å‹
            if (s1 == null)
                return -1;
            if (s2 == null)
                return 1;
            return s1.length() - s2.length();
        });
//        Consumer
        strList.forEach((s) ->
                System.out.println(s)
        );

        System.out.println(strList);
    }

//è°ˆè°ˆæˆ‘å¯¹lambdaè¡¨è¾¾å¼çš„ç†è§£ï¼Œæ¥å£å®šä¹‰äº†å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºçš„ç±»å‹ï¼›
//ä»¥èŒƒç•´å­¦çš„è¯´æ³•ï¼Œ å®šä¹‰äº† å‡½å­çš„ç±»å‹ï¼Œæ¥å£çš„å®ç°å°±æ˜¯ è¿™ä¸ªå‡½å­çš„mapæ¥å£ä¼ å…¥çš„å˜å½¢æ–¹æ³•
// ä¸€èˆ¬çº¦å®šï¼Œå‡½å­çš„æ ‡å¿—å°±æ˜¯å®¹å™¨å…·æœ‰mapæ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†å®¹å™¨é‡Œé¢çš„æ¯ä¸€ä¸ªå€¼ï¼Œæ˜ å°„åˆ°å¦ä¸€ä¸ªå®¹å™¨ã€‚
    
    public static void eval(List<Integer> list, Predicate<Integer> predicate) {
        for (Integer n : list) {

            if (predicate.test(n)) {
                System.out.println(n + " ");
            }
        }
    }
}

```

æˆ‘æœ€æƒ³è¯´çš„æ˜¯ just show code;ä½†è¿™æ ·æœ‰ç‚¹å¤ªæ— è€»äº†ï¼ŒğŸ˜„ã€‚

2. **æˆ‘çš„ä¸€äº›æƒ³æ³•**ï¼šå°†java çš„ç±»çš„æ–¹æ³•æŠ½è±¡ä¸ºçº¯ç²¹çš„æ•°å­¦è¿ç®—ï¼Œä¸å¸¦æœ‰æˆå‘˜å˜é‡çš„ä½¿ç”¨ã€‚å°±åªæ˜¯ èŒƒç•´å­¦ä¸­çš„ä¸€ä¸ª ç‰¹æ®Šçš„èŒƒç•´å³å‡½å­ è½¬æ¢çš„ç®¡é“ã€‚åœ¨java8ä¸­çš„æç°å°±æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆæˆ‘è§åˆ°æ˜¯ä»¥FunctionalInterfaceæ³¨è§£ï¼‰çš„å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼ˆè¯¥æ¥å£å†…éƒ¨åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼‰ï¼Œå®ƒè§„å®šäº† è¾“å…¥å’Œè¾“å‡ºçš„æˆå‘˜çš„ç±»å‹ï¼ˆä¹Ÿæ˜¯ä¸€ç§é›†åˆï¼‰ï¼Œå°±æ˜¯è¯´java8è¿˜ç¦»ä¸å¼€java æ˜¯å¼ºç±»å‹æ£€æŸ¥è¿™ä¸ªè¯­è¨€ç‰¹æ€§ã€‚


3. ä¸‹é¢æ˜¯ä¸Šé¢ä»£ç  Predicateæ¥å£è°ƒç”¨å¤„å­—èŠ‚ç ï¼š

    - 
    ``` java
    
     eval(list, n -> n > 3);
    
    //å­—èŠ‚ç 
     101: invokevirtual #7                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
           104: aload_1
           105: invokedynamic #11,  0             // InvokeDynamic #1:test:()Ljava/util/function/Predicate;
           110: invokestatic  #9                  // Method eval:(Ljava/util/List;Ljava/util/function/Predicate;)V
    
    ```

    - å¯ä»¥çœ‹å‡ºçš„ invokedynamic è¿™ä¸ªjava7 æ–°å¼•å…¥çš„å®ç°åŠ¨æ€ç±»å‹è¯­è¨€ æŒ‡ä»¤ã€‚è€Œlambdaè¡¨è¾¾å¼åŠ¨æ€è°ƒç”¨ æ˜¯æŒ‡ ç±»å‹æ¨æ–­æœºåˆ¶ï¼Œåœ¨ä¸Šä¸‹æ–‡ä¿¡æ¯è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡ºå‚æ•°è¡¨çš„ç±»å‹ï¼Œè€Œä¸éœ€è¦æ˜¾å¼æŒ‡åã€‚

    - 
        ``` java

        InnerClasses:
            public static final #201= #200 of #204; //Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles
        BootstrapMethods:
        0: #93 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;
            Method arguments:
            #94 (Ljava/lang/Object;)Z
            #95 invokestatic com/reflex/service/Java8Test.lambda$main$0:(Ljava/lang/Integer;)Z
            #96 (Ljava/lang/Integer;)Z
        1: #93 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;
            Method arguments:
            #100 ()V
            #101 invokestatic com/reflex/service/Java8Test.lambda$main$1:()V
            #100 ()V
        2: #93 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;
            Method arguments:
            #110 (Ljava/lang/Object;Ljava/lang/Object;)I
            #111 invokestatic com/reflex/service/Java8Test.lambda$main$2:(Ljava/lang/String;Ljava/lang/String;)I
            #112 (Ljava/lang/String;Ljava/lang/String;)I
        3: #93 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;
            Method arguments:
            #116 (Ljava/lang/Object;)V
            #117 invokestatic com/reflex/service/Java8Test.lambda$main$3:(Ljava/lang/String;)V
            #118 (Ljava/lang/String;)V

        ```

4. è¿™è¾¹æœ‰ä¸ªç–‘é—®ï¼Œè¿™æ®µå­—èŠ‚ç æ˜¯æ˜¯ä¸»ç±» InnerClasses çš„BootstrapMethodsï¼Œå°±æ˜¯ä¸Šé¢ invokedynamicåªæ˜¯è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªæ–¹æ³• lambda$main$0 è¿™ä¸ªé™æ€æ–¹æ³•ã€‚æˆ‘ä¸€ç›´æ‰¾ä¸åˆ°
eval(list, n -> n > 3)ä¸­n>3 å³  boolean test(T t)è¿™ä¸ªæŠ½è±¡æ–¹æ³•å®ç°çš„å­—èŠ‚ç ï¼Ÿ


5. ä»Šå¤©çœ‹åˆ°ä¸€ä¸ªjava8å®æˆ˜ä¸€ä¸ªè¯´æ³•ï¼š
    > ç¼–ç¨‹è¯­è¨€çš„æ•´ä¸ªç›®çš„å°±åœ¨äºæ“ä½œå€¼ï¼Œè¦æ˜¯æŒ‰ç…§å†å² ä¸Šç¼–ç¨‹è¯­è¨€çš„ä¼ ç»Ÿï¼Œè¿™äº›å€¼å› æ­¤è¢«ç§°ä¸ºä¸€ç­‰å€¼(æˆ–ä¸€ç­‰å…¬æ°‘)ã€‚ç¼–ç¨‹è¯­è¨€ä¸­çš„å…¶ä»–ç»“æ„ä¹Ÿè®¸æœ‰åŠ©äºæˆ‘ä»¬è¡¨ç¤ºå€¼çš„ç»“æ„ï¼Œä½†åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´ ä¸èƒ½ä¼ é€’ï¼Œå› è€Œæ˜¯äºŒç­‰å…¬æ°‘ã€‚å‰é¢æ‰€è¯´çš„å€¼æ˜¯Javaä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼Œä½†å…¶ä»–å¾ˆå¤šJavaæ¦‚å¿µ(å¦‚æ–¹æ³• å’Œç±»ç­‰)åˆ™æ˜¯äºŒç­‰å…¬æ°‘ã€‚ç”¨æ–¹æ³•æ¥å®šä¹‰ç±»å¾ˆä¸é”™ï¼Œç±»è¿˜å¯ä»¥å®ä¾‹åŒ–æ¥äº§ç”Ÿå€¼ï¼Œä½†æ–¹æ³•å’Œç±»æœ¬èº«éƒ½ ä¸æ˜¯å€¼ã€‚è¿™åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢?è¿˜çœŸæœ‰ï¼Œäººä»¬å‘ç°ï¼Œåœ¨è¿è¡Œæ—¶ä¼ é€’æ–¹æ³•èƒ½å°†æ–¹æ³•å˜æˆä¸€ç­‰å…¬æ°‘ã€‚è¿™ åœ¨ç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ï¼Œå› æ­¤Java 8çš„è®¾è®¡è€…æŠŠè¿™ä¸ªåŠŸèƒ½åŠ å…¥åˆ°äº†Javaä¸­

    - ä½†javaä¸­åŒ¿åå†…éƒ¨ç±»æ˜¯å¯ä»¥ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡çš„ï¼Œå°±æ˜¯è¯´ å‡½æ•°æ˜¯æœ‰çŠ¶æ€çš„ï¼Œè¿™ä¸ªå°±æ˜¯æœ‰ç‚¹ç–‘æƒ‘

    > è¦è¢«ç§°ä¸ºå‡½æ•°å¼ï¼Œå‡½æ•°æˆ–è€…æ–¹æ³•ä¸åº”è¯¥æŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œæœ‰ ä¸€ä¸ªæä¸ºç®€å•è€Œåˆæä¸ºæ•™æ¡çš„è§£é‡Š:ä½ ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºä¸€æ—¦æŠ›å‡ºå¼‚å¸¸ï¼Œå°±æ„å‘³ç€ç»“æœè¢« 3 ç»ˆæ­¢äº†;ä¸å†åƒæˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„é»‘ç›’æ¨¡å¼é‚£æ ·ï¼Œç”±returnè¿”å›ä¸€ä¸ªæ°å½“çš„ç»“æœå€¼ã€‚



